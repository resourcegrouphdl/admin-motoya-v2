   <div class="reasignacion-dialog">
      <div class="dialog-header">
        <h2 mat-dialog-title class="text-xl font-semibold text-gray-900">
          Reasignar Solicitud
        </h2>
        <button mat-icon-button mat-dialog-close class="text-gray-400 hover:text-gray-600">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-dialog-content class="dialog-content">
        <!-- Información de la solicitud -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <h3 class="font-medium text-gray-900 mb-2">Solicitud a reasignar</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <span class="text-gray-600">Número:</span>
              <span class="font-medium ml-2">{{ data.solicitud.numeroSolicitud }}</span>
            </div>
            <div>
              <span class="text-gray-600">Estado:</span>
              <mat-chip class="ml-2 text-xs">{{ data.solicitud.estado }}</mat-chip>
            </div>
            <div>
              <span class="text-gray-600">Evaluador actual:</span>
              <span class="font-medium ml-2">{{ evaluadorActual() || 'Sin asignar' }}</span>
            </div>
            <div>
              <span class="text-gray-600">Tiempo en estado:</span>
              <span class="font-medium ml-2">{{ data.solicitud.diasEnEstado }} días</span>
            </div>
          </div>
        </div>

        <!-- Formulario de reasignación -->
        <form [formGroup]="reasignacionForm" class="space-y-4">
          
          <!-- Seleccionar tipo de evaluación -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tipo de Evaluación</mat-label>
            <mat-select formControlName="tipoEvaluacion" 
                       (selectionChange)="cargarEvaluadores()">
              <mat-option value="documental">Evaluación Documental</mat-option>
              <mat-option value="garantes">Evaluación de Garantes</mat-option>
              <mat-option value="entrevista">Entrevista</mat-option>
              <mat-option value="decision">Decisión Final</mat-option>
            </mat-select>
            <mat-error *ngIf="reasignacionForm.get('tipoEvaluacion')?.hasError('required')">
              Seleccione el tipo de evaluación
            </mat-error>
          </mat-form-field>

          <!-- Loading evaluadores -->
          <div *ngIf="cargandoEvaluadores()" class="flex justify-center py-4">
            <mat-spinner diameter="30"></mat-spinner>
            <span class="ml-3 text-gray-600">Cargando evaluadores...</span>
          </div>

          <!-- Lista de evaluadores disponibles -->
          <div *ngIf="!cargandoEvaluadores() && evaluadoresDisponibles().length > 0" class="space-y-3">
            <label class="block text-sm font-medium text-gray-700">
              Seleccionar Evaluador
            </label>
            
            <div class="space-y-2 max-h-60 overflow-y-auto">
              <div *ngFor="let evaluador of evaluadoresDisponibles(); trackBy: trackByEvaluadorId"
                   class="border rounded-lg p-3 cursor-pointer transition-all duration-200"
                   [ngClass]="{
                     'border-blue-500 bg-blue-50': evaluadorSeleccionado()?.id === evaluador.id,
                     'border-gray-200 hover:border-gray-300': evaluadorSeleccionado()?.id !== evaluador.id,
                     'opacity-50 cursor-not-allowed': !evaluador.disponible
                   }"
                   (click)="seleccionarEvaluador(evaluador)"
                   [class.disabled]="!evaluador.disponible">
                
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <span class="font-medium text-gray-900">{{ evaluador.nombre }}</span>
                      <mat-chip class="text-xs" 
                               [ngClass]="{
                                 'bg-green-100 text-green-800': evaluador.disponible,
                                 'bg-red-100 text-red-800': !evaluador.disponible
                               }">
                        {{ evaluador.disponible ? 'Disponible' : 'Ocupado' }}
                      </mat-chip>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">
                      Especialidad: {{ formatearEspecialidad(evaluador.especialidad) }}
                    </div>
                  </div>
                  
                  <div class="text-right text-sm text-gray-600">
                    <div>{{ evaluador.cargaTrabajo.solicitudesPendientes }} pendientes</div>
                    <div>{{ evaluador.cargaTrabajo.tiempoPromedioEvaluacion | number:'1.0-0' }}m promedio</div>
                  </div>
                </div>

                <!-- Indicador de carga de trabajo -->
                <div class="mt-2">
                  <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span>Carga de trabajo</span>
                    <span>{{ calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas) }}%</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="h-2 rounded-full transition-all duration-300"
                         [ngClass]="{
                           'bg-green-500': calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas) < 70,
                           'bg-yellow-500': calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas) >= 70 && calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas) < 90,
                           'bg-red-500': calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas) >= 90
                         }"
                         [style.width.%]="calcularPorcentajeCarga(evaluador.cargaTrabajo.solicitudesAsignadas)">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No hay evaluadores disponibles -->
          <div *ngIf="!cargandoEvaluadores() && evaluadoresDisponibles().length === 0 && reasignacionForm.get('tipoEvaluacion')?.value" 
               class="text-center py-4 text-gray-500">
            <mat-icon class="text-4xl mb-2">person_off</mat-icon>
            <p>No hay evaluadores disponibles para este tipo de evaluación</p>
          </div>

          <!-- Motivo de reasignación -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Motivo de Reasignación</mat-label>
            <mat-select formControlName="motivo">
              <mat-option value="carga_trabajo">Redistribución de carga de trabajo</mat-option>
              <mat-option value="especialidad">Requiere especialización específica</mat-option>
              <mat-option value="urgente">Solicitud urgente</mat-option>
              <mat-option value="ausencia">Ausencia del evaluador</mat-option>
              <mat-option value="otro">Otro motivo</mat-option>
            </mat-select>
            <mat-error *ngIf="reasignacionForm.get('motivo')?.hasError('required')">
              Seleccione el motivo de reasignación
            </mat-error>
          </mat-form-field>

          <!-- Observaciones adicionales -->
          <mat-form-field appearance="outline" class="w-full" 
                         *ngIf="reasignacionForm.get('motivo')?.value === 'otro'">
            <mat-label>Observaciones</mat-label>
            <textarea matInput 
                     formControlName="observaciones"
                     rows="3"
                     placeholder="Detalle el motivo de la reasignación..."></textarea>
            <mat-error *ngIf="reasignacionForm.get('observaciones')?.hasError('required')">
              Las observaciones son requeridas cuando selecciona "Otro motivo"
            </mat-error>
          </mat-form-field>

        </form>
      </mat-dialog-content>

      <mat-dialog-actions class="dialog-actions">
        <button mat-button mat-dialog-close class="text-gray-600">
          Cancelar
        </button>
        <button mat-raised-button 
                color="primary"
                [disabled]="!puedeReasignar() || procesando()"
                (click)="confirmarReasignacion()">
          <mat-spinner diameter="16" class="mr-2" *ngIf="procesando()"></mat-spinner>
          {{ procesando() ? 'Reasignando...' : 'Reasignar' }}
        </button>
      </mat-dialog-actions>
    </div>
