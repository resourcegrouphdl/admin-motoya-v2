<div class="min-h-screen bg-gray-50 p-6">
      <!-- Header -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex justify-between items-center">
            <div>
              <h1 class="text-xl font-semibold text-gray-900">
                Cola de Trabajo - Evaluaciones Pendientes
              </h1>
              <p class="text-sm text-gray-600 mt-1">
                {{ solicitudesFiltradas().length }} solicitudes | 
                {{ solicitudesVencidas() }} vencidas |
                {{ solicitudesUrgentes() }} urgentes
              </p>
            </div>
            <div class="flex gap-4 items-center">
              <!-- Filtros -->
              <mat-form-field appearance="outline" class="w-40">
                <mat-label>Etapa</mat-label>
                <mat-select [value]="filtroEtapa()" (selectionChange)="cambiarFiltroEtapa($event.value)">
                  <mat-option value="">Todas las etapas</mat-option>
                  <mat-option value="documental">Eval. Documental</mat-option>
                  <mat-option value="garantes">Eval. Garantes</mat-option>
                  <mat-option value="entrevista">Entrevistas</mat-option>
                  <mat-option value="decision">Decisión Final</mat-option>
                </mat-select>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="w-44">
                <mat-label>Prioridad</mat-label>
                <mat-select [value]="filtroPrioridad()" (selectionChange)="cambiarFiltroPrioridad($event.value)">
                  <mat-option value="">Todas las prioridades</mat-option>
                  <mat-option value="Alta">Alta prioridad</mat-option>
                  <mat-option value="Media">Prioridad media</mat-option>
                  <mat-option value="Baja">Prioridad baja</mat-option>
                </mat-select>
              </mat-form-field>
              
              <button mat-raised-button color="primary" 
                      (click)="actualizarCola()" 
                      [disabled]="cargando()"
                      class="h-10">
                <mat-icon>refresh</mat-icon>
                Actualizar
              </button>
            </div>
          </div>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="cargando()" class="flex justify-center items-center py-8">
          <mat-spinner diameter="40"></mat-spinner>
          <span class="ml-4 text-gray-600">Cargando solicitudes...</span>
        </div>

        <!-- Empty State -->
        <div *ngIf="!cargando() && solicitudesFiltradas().length === 0" class="text-center py-12">
          <mat-icon class="text-6xl text-gray-400 mb-4">inbox</mat-icon>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No hay solicitudes pendientes</h3>
          <p class="text-gray-600">No se encontraron solicitudes que coincidan con los filtros seleccionados.</p>
        </div>
        
        <!-- Tabla -->
        <div class="overflow-x-auto" *ngIf="!cargando() && solicitudesFiltradas().length > 0">
          <table mat-table [dataSource]="solicitudesFiltradas()" class="w-full">
            
            <!-- Columna Prioridad -->
            <ng-container matColumnDef="prioridad">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Prioridad</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" 
                       [ngClass]="{
                         'bg-red-500': solicitud.prioridad === 'Alta',
                         'bg-yellow-500': solicitud.prioridad === 'Media',
                         'bg-green-500': solicitud.prioridad === 'Baja'
                       }"></div>
                  <span class="text-sm font-medium">{{ solicitud.prioridad }}</span>
                  <mat-icon *ngIf="solicitud.estaVencido" 
                           class="text-red-500 text-base ml-1" 
                           matTooltip="Solicitud vencida">
                    warning
                  </mat-icon>
                </div>
              </td>
            </ng-container>

            <!-- Columna Solicitud -->
            <ng-container matColumnDef="solicitud">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Solicitud</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div>
                  <span class="font-semibold text-blue-600 hover:text-blue-800 cursor-pointer">
                    {{ solicitud.numeroSolicitud }}
                  </span>
                  <div class="text-xs text-gray-500">
                    {{ solicitud.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Columna Cliente -->
            <ng-container matColumnDef="cliente">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Cliente</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold text-sm">
                    {{ solicitud.cliente.avatar }}
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900">
                      {{ solicitud.cliente.nombre }} {{ solicitud.cliente.apellidos }}
                    </div>
                    <div class="text-sm text-gray-500">DNI: {{ solicitud.cliente.dni }}</div>
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Columna Vehículo -->
            <ng-container matColumnDef="vehiculo">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Vehículo</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <span class="text-gray-900">{{ solicitud.vehiculo }}</span>
              </td>
            </ng-container>

            <!-- Columna Monto -->
            <ng-container matColumnDef="monto">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Monto</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div>
                  <span class="font-semibold text-gray-900">S/ {{ solicitud.monto | number:'1.0-0' }}</span>
                  <div class="text-xs text-gray-500">
                    {{ solicitud.solicitudOriginal.plazoQuincenas }} quincenas
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Columna Estado -->
            <ng-container matColumnDef="estado">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Estado</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <mat-chip class="text-sm" [ngClass]="getEstadoClasses(solicitud.estadoColor)">
                  {{ solicitud.estado }}
                </mat-chip>
              </td>
            </ng-container>

            <!-- Columna Asignado a -->
            <ng-container matColumnDef="asignadoA">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Asignado a</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <span class="text-gray-900">{{ solicitud.asignadoA || 'Sin asignar' }}</span>
              </td>
            </ng-container>

            <!-- Columna Tiempo -->
            <ng-container matColumnDef="tiempo">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Tiempo</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div class="flex items-center gap-1" [ngClass]="{
                  'text-red-600': solicitud.tiempoColor === 'error',
                  'text-yellow-600': solicitud.tiempoColor === 'warning',
                  'text-green-600': solicitud.tiempoColor === 'success'
                }">
                  <mat-icon class="text-base" *ngIf="solicitud.tiempoColor === 'error'">warning</mat-icon>
                  <mat-icon class="text-base" *ngIf="solicitud.tiempoColor === 'warning'">schedule</mat-icon>
                  <mat-icon class="text-base" *ngIf="solicitud.tiempoColor === 'success'">check_circle</mat-icon>
                  <span class="text-sm font-medium">{{ solicitud.tiempo }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Columna Progreso -->
            <ng-container matColumnDef="progreso">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Progreso</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                       [style.width.%]="solicitud.solicitudOriginal.porcentajeProgreso">
                  </div>
                </div>
                <span class="text-xs text-gray-600 mt-1">
                  {{ solicitud.solicitudOriginal.porcentajeProgreso }}%
                </span>
              </td>
            </ng-container>

            <!-- Columna Acciones -->
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef class="font-medium text-gray-700 px-6 py-4">Acciones</th>
              <td mat-cell *matCellDef="let solicitud" class="px-6 py-4">
                <div class="flex gap-2">
                  <button mat-mini-fab color="primary" 
                          (click)="abrirExpediente(solicitud); $event.stopPropagation()"
                          matTooltip="Abrir expediente"
                          [disabled]="procesandoAccion() === solicitud.id">
                    <mat-icon>folder_open</mat-icon>
                  </button>
                  <button mat-mini-fab 
                          color="accent"
                          (click)="aprobarEtapa(solicitud); $event.stopPropagation()"
                          matTooltip="Aprobar etapa"
                          [disabled]="procesandoAccion() === solicitud.id">
                    <mat-icon>check</mat-icon>
                  </button>
                  <button mat-mini-fab 
                          color="warn"
                          (click)="observarSolicitud(solicitud); $event.stopPropagation()"
                          matTooltip="Observar"
                          [disabled]="procesandoAccion() === solicitud.id">
                    <mat-icon>warning</mat-icon>
                  </button>
                  <button mat-mini-fab 
                          (click)="reasignarSolicitud(solicitud); $event.stopPropagation()"
                          matTooltip="Reasignar"
                          [disabled]="procesandoAccion() === solicitud.id">
                    <mat-icon>assignment_ind</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                class="hover:bg-gray-50 cursor-pointer transition-colors duration-200"
                [ngClass]="{
                  'border-l-4 border-red-500': row.prioridad === 'Alta',
                  'border-l-4 border-yellow-500': row.prioridad === 'Media',
                  'border-l-4 border-green-500': row.prioridad === 'Baja',
                  'bg-red-50': row.estaVencido,
                  'bg-yellow-50': row.requiereAccion && !row.estaVencido
                }"
                (click)="abrirExpediente(row)"></tr>
          </table>
        </div>
      </div>
    </div>